{"ast":null,"code":"import _regeneratorRuntime from\"D:/CFD/react JS/react-cfd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"D:/CFD/react JS/react-cfd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"D:/CFD/react JS/react-cfd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/CFD/react JS/react-cfd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{BrowserRouter,useHistory}from\"react-router-dom\";import userApi from\"../api/userApi\";import{jsx as _jsx}from\"react/jsx-runtime\";export var Context=/*#__PURE__*/React.createContext();function App(_ref){var children=_ref.children;var _useState=useState(JSON.parse(localStorage.getItem('auth'))||{login:false,user:null}),_useState2=_slicedToArray(_useState,2),auth=_useState2[0],setAuth=_useState2[1];useEffect(function(){if(auth.login){localStorage.setItem('auth',JSON.stringify(auth));if(auth.user.token){localStorage.setItem('token',JSON.stringify(auth.user.token));}}else{localStorage.removeItem('auth');localStorage.removeItem('token');}},[auth]);function handleLogin(_x){return _handleLogin.apply(this,arguments);}function _handleLogin(){_handleLogin=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(form){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return userApi.login(form);case 2:res=_context.sent;if(!res.error){_context.next=7;break;}return _context.abrupt(\"return\",res);case 7:setAuth({login:true,user:res.data});case 8:case\"end\":return _context.stop();}}},_callee);}));return _handleLogin.apply(this,arguments);}function updateInfoProfile(data){setAuth(_objectSpread(_objectSpread({},auth),{},{user:data}));}function logout(){setAuth({login:false,user:null});}var history=useHistory();function linkLoading(e){document.body.classList.remove('menu-is-show');document.querySelector('.loading-page').style.transform='scale(25)';e.preventDefault();setTimeout(function(){var _e$target$href;history.push(((_e$target$href=e.target.href)===null||_e$target$href===void 0?void 0:_e$target$href.replace(window.location.origin,''))||\"\");document.querySelector('.loading-page').style.transform='scale(0)';},1000);}function popupLogin(){var flag=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;document.getElementById('popupLogin').style.display=flag?\"flex\":\"none\";}return/*#__PURE__*/_jsx(Context.Provider,{value:_objectSpread(_objectSpread({},auth),{},{handleLogin:handleLogin,logout:logout,linkLoading:linkLoading,popupLogin:popupLogin,updateInfoProfile:updateInfoProfile}),children:children});}export default function AppProvider(_ref2){var children=_ref2.children;return/*#__PURE__*/_jsx(BrowserRouter,{children:/*#__PURE__*/_jsx(App,{children:children})});}","map":{"version":3,"sources":["D:/CFD/react JS/react-cfd/src/core/AppProvider.jsx"],"names":["React","useEffect","useState","BrowserRouter","useHistory","userApi","Context","createContext","App","children","JSON","parse","localStorage","getItem","login","user","auth","setAuth","setItem","stringify","token","removeItem","handleLogin","form","res","error","data","updateInfoProfile","logout","history","linkLoading","e","document","body","classList","remove","querySelector","style","transform","preventDefault","setTimeout","push","target","href","replace","window","location","origin","popupLogin","flag","getElementById","display","AppProvider"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { BrowserRouter, useHistory } from \"react-router-dom\";\r\nimport userApi from \"../api/userApi\";\r\n\r\n\r\n\r\n\r\nexport let Context = React.createContext()\r\n\r\n\r\nfunction App({ children }) {\r\n\r\n    let [auth, setAuth] = useState(JSON.parse(localStorage.getItem('auth')) || {\r\n        login: false,\r\n        user: null,\r\n    })\r\n\r\n\r\n\r\n    useEffect(() => {\r\n        if (auth.login) {\r\n            localStorage.setItem('auth', JSON.stringify(auth))\r\n            if (auth.user.token) {\r\n                localStorage.setItem('token', JSON.stringify(auth.user.token))\r\n            }\r\n        } else {\r\n            localStorage.removeItem('auth')\r\n            localStorage.removeItem('token')\r\n        }\r\n\r\n    }, [auth])\r\n\r\n\r\n\r\n    async function handleLogin(form) {\r\n\r\n        let res = await userApi.login(form)\r\n        if (res.error) {\r\n            return res\r\n        } else {\r\n            setAuth({\r\n                login: true,\r\n                user: res.data\r\n            })\r\n\r\n        }\r\n\r\n    }\r\n    function updateInfoProfile(data) {\r\n        setAuth({\r\n            ...auth,\r\n            user: data\r\n        })\r\n    }\r\n\r\n    function logout() {\r\n        setAuth({\r\n            login: false,\r\n            user: null\r\n        })\r\n    }\r\n    let history = useHistory()\r\n\r\n    function linkLoading(e) {\r\n\r\n        document.body.classList.remove('menu-is-show')\r\n        document.querySelector('.loading-page').style.transform = 'scale(25)'\r\n        e.preventDefault();\r\n        setTimeout(() => {\r\n            history.push(e.target.href?.replace(window.location.origin, '') || \"\")\r\n            document.querySelector('.loading-page').style.transform = 'scale(0)'\r\n        }, 1000)\r\n\r\n    }\r\n\r\n    function popupLogin(flag = true) {\r\n        document.getElementById('popupLogin').style.display = flag ? \"flex\" : \"none\"\r\n    }\r\n\r\n\r\n    return (\r\n        <Context.Provider value={{ ...auth, handleLogin, logout, linkLoading, popupLogin, updateInfoProfile }}>\r\n            {children}\r\n        </Context.Provider>\r\n    );\r\n}\r\nexport default function AppProvider({ children }) {\r\n    return <BrowserRouter>\r\n        <App>\r\n            {children}\r\n        </App>\r\n    </BrowserRouter>\r\n}\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}